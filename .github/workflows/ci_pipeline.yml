name: CI Pipeline - Build & Test

# Trigger: Run this whenever code is pushed to the 'main' branch
on:
  push:
    branches: [ "main" ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest  # GitHub rents a generic Linux server for us

    steps:
    # 1. Check out the code from your repo
    - name: Checkout Code
      uses: actions/checkout@v3

    # 2. Set up Python 3.9 (Matching your Dockerfile)
    - name: Set up Python 3.9
      uses: actions/setup-python@v4
      with:
        python-version: "3.9"

    # 3. Install Dependencies
    - name: Install Libraries
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements_production

    # 4. Run a "Sanity Check" (Unit Test)
    # We try to import the app to ensure no syntax errors exist
    - name: Test Application Import
      run: |
        python -c "import app; print('App checks out OK!')"

    # 5. Build the Docker Image
    # This proves the Dockerfile is valid
    - name: Build Docker Image
      run: |
        docker build -t customer-churn-api:latest .
        echo "Docker Image built successfully!"